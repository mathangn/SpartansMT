<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../../assets/css/cart/payment-page.css">
    <link href="https://fonts.googleapis.com/css2?family=Barlow&family=Barlow+Condensed:wght@400;700&display=swap"
        rel="stylesheet">
    <title>SpartansMT</title>
    <link rel="icon" type="image/png" sizes="32x32" href="../../assets/image/home/logo icon.png" alt="logo icon">
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@48,400,0,0">
</head>

<body>
    <nav id="#homepage">
        <img id="logo" src="../../assets/image/home/logo1.png" alt="logo1">
        <ul>
            <li>
<a href="../home/home.html">Home</a>
</li>
            <li>
<a href="../stores/stores.html">Stores</a>
</li>
            <li>
<a href="../offer/offer.html">Offers</a>
</li>
            <li>
<a href="../entertainment/entertainment.html">Entertainment</a>
</li>
            <li>
<a href="../foodcourt/foodcourt.html">Foodcourt</a>
</li>
            <li>
<a href="../services/services.html">Services</a>
</li>
            <li>
<a href="../../pages/cart/add-to- cart.html">
                <i id="cart_icon" class="material-symbols-outlined">shopping_cart</i>
            </a></li>

                        <p id="cart_count"></p>

                        <li class="dropdown">
                            <i class="material-symbols-outlined">expand_more</i>
                            <div class="dropdown-content">
                                <a href="../home/profile.html">
                                    <p>
                                        <i class="material-symbols-outlined">person</i>
                                        Profile
                                    </p>
                                </a>
                                <a href="../home/profile.html?id=orders">
                                    <p>
                                        <i class="material-symbols-outlined">shopping_bag</i>
                                        My Orders
                                    </p>
                                </a>
                                <a href="../home/profile.html?id=wishlist">
                                    <p>
                                        <i class="material-symbols-outlined">favorite</i>
                                        WishList
                                    </p>
                                </a>
                                <a href="../../index.html">
                                    <p>
                                        <i class="material-symbols-outlined">logout</i>
                                        Logout
                                    </p>
                                </a>
                            </div>
                        </li>

        </ul>
    </nav>
    <!-- 
    <header>
        <div class="header">
            <div class="heading">
                <h1>PAYMENT OPTIONS</h1>
            </div>
            <div>
                <div>
                    <div class="gif-alinment">
                        <label aria-label="upi"><input type="radio" value="upi" name="upi"></label>
                        <img class="gif" src="../../assets/image/stores/UPI.gif" alt="gif">
                        <p class="payment-options-name">UPI</p>
                    </div>
            
                    <div class="upi">
                        <p class="payment-options-name">Choose an option</p>
                        <label for="upi"><input type="radio" name="upi">PhonePe</label><br>
                        <label for="upi"><input type="radio" name="upi">Your UPI ID</label>
                    </div>
                    
                    <div class="gif-alinment">
                        <label aria-label="upi"><input type="radio" value="wallets" name="upi"></label>
                        <img class="gif" src="../../assets/image/stores/Wallets.gif" alt="glf"/>
                        <p class="payment-options-name">Wallets</p>
                    </div>

                    <div class="gif-alinment">
                        <label aria-label="upi"><input type="radio" value="card-details" name="upi"></label>
                        <p class="payment-options-name">Credit / Debit / ATM Card</p>
                    </div>

                    <div class="gif-alinment">
                        <label aria-label="upi"><input type="radio" value="net-banking" name="upi"></label>
                        <p class="payment-options-name">Net Banking</p>
                    </div>

                    <div class="gif-alinment">
                        <label aria-label="upi"><input type="radio" value="cash-on-delivery" name="upi"></label>
                        <p class="payment-options-name">Cash On Delivery</p>
                    </div>

                </div>
            </div>
            <a href="../../pages/home/home.html"><p class="place-order-btn">Place Order</p></a>
        </div>

        <div id="price">
            <h2>PRICE DETAILS</h2>
            <hr>
            <div class="price-details">
                <h3>Price ( 1 item )</h3>
                <h3>&#8377; 6000</h3>
            </div>
            <div class="price-details">
                <h3>Delivery Charges</h3>
                <h3>FREE</h3>
            </div>
            <hr>
            <div class="price-details">
                <h3>Amount Payable</h3>
                <h3>&#8377; 6000</h3>
            </div>
            <hr>
        </div>
    </header> -->

    <!-- New Payment Page Starting -->

    <!-- <form action="" onsubmit="page()">

        <div class="cards">
            <div>
                <input type="radio">
                <img src="../../assets/image/home/mastercard.png" alt="card brands">
            </div>

            <div>
                <input type="radio">
                <img src="../../assets/image/home/paypal.png" alt="card brands">
            </div>

            <div>
                <input type="radio">
                <img src="../../assets/image/home/visa.jfif" alt="card brands">
            </div>

            <div>
                <input type="radio">
                <h2>CASH ON<br>DELIVERY</h2>
            </div>

        </div>

        <div class="label margin">
            <label for="">Card number*
                <input type="number" class="input_box">
            </label>
            <label for="">Cardholder*
                <input type="text" class="input_box">
            </label>
        </div>

        <div class="label margin">
            <label for="">Expiry date*
                <select name="" id="" class="select_box">
                    <option value="">Month</option>
                    <option value="">01</option>
                    <option value="">02</option>
                    <option value="">03</option>
                    <option value="">04</option>
                    <option value="">05</option>
                    <option value="">06</option>
                    <option value="">07</option>
                    <option value="">08</option>
                    <option value="">09</option>
                    <option value="">10</option>
                    <option value="">11</option>
                    <option value="">12</option>
                </select>

                <select name="" id="" class="select_box">
                    <option value="">Year</option>
                    <option value="">2023</option>
                    <option value="">2024</option>
                    <option value="">2025</option>
                    <option value="">2026</option>
                    <option value="">2027</option>
                    <option value="">2028</option>
                    <option value="">2029</option>
                    <option value="">2030</option>
                    <option value="">2031</option>
                    <option value="">2032</option>
                </select>
            </label>

            <label for="">CVC
                <input type="number" class="input_box">
                <span>!</span>
            </label>
        </div>

        <label for="">
            <input type="checkbox" id="checkbox">Save my details for future purchases
        </label>

        <div class="total_background margin">

            <div class="label">
                <h3>Subtotal</h3>
                <h3>$60.80</h3>
            </div>
            <div class="label">
                <p>Home Delivery Cost</p>
                <p>Free Delivery</p>
            </div>

        </div>
        <div class="label total_background">
            <h3>TOTAL AMOUNT</h3>
            <h3>$60.80</h3>
        </div>

        <a href="confirm_order.html">
        <div class="label btn margin">
                <p>.</p>
                <button>CONFIRM PAYMENT</button>
                <p>.</p>
        </div>
    </a>

    </form> -->

    <h1 id="checkout">CHECKOUT</h1>

    <form id="form">

        <header>

            <div id="left_div">

                <div>

                    <h2>Personal Details</h2>
                    <div>

                        <div>
                            <label for="">First Name
                                <br>
                                <input id="first_name" type="text" class="input" disabled>
                            </label>
                        </div>

                        <div>
                            <label for="">Last Name
                                <br>
                                <input id="last_name" type="text" class="input" disabled>
                            </label>
                        </div>

                        <div>
                            <label for="">Email Address
                                <br>
                                <input id="email" type="email" class="input" disabled>
                            </label>
                        </div>

                        <div>
                            <label for="">Phone Number
                                <br>
                                <input id="phone_number" pattern="[789][0-9]{9}" type="number" class="input" disabled>
                            </label>
                        </div>

                    </div>

                </div>

                <div>

                    <h2>Shipping Details</h2>
                    <div>
                        <h3 id="shipping_address">Shipping Address</h3>

                        <div>
                            <label for="">Street Address
                                <br>
                                <input type="text" id="address" required>
                            </label>
                        </div>

                        <div>
                            <label for="">Country
                                <br>
                                <input type="text" id="country" class="address" required>
                            </label>
                        </div>

                        <div>
                            <label for="">State
                                <br>
                                <input type="text" id="state" class="address" required>
                            </label>
                        </div>

                        <div>
                            <label for="">Zip code
                                <br>
                                <input type="number" pattern="[0-9]{6}" id="zip_code" class="address" required>
                            </label>
                        </div>

                    </div>

                </div>

                <div>

                    <p>Payment Method</p>
                    <div>

                        <div class="payment_input_align">

                            <label for="">
                                <img class="icon_img" src="../../assets/image/home/paypal.png" alt="icon">
                                Paypal
                            </label>
                            <input name="Payment" type="radio" value="Paypal" class="radio" required>

                        </div>

                        <div class="payment_input_align">

                            <label for="">
                                <img class="icon_img" src="../../assets/image/home/cash_on_delivery.png" alt="icon">
                                Cash on delivery
                            </label>
                            <input name="Payment" type="radio" value="Cash on delivery" class="radio" required>

                        </div>

                        <div id="paypal_varify">

                            <label for="">
                                Paypal Email Address
                                <br>
                                <input type="email">

                            </label>

                        </div>

                        <div id="card-details">

                            <label for="">
                                Card number
                                <br>
                                <input id="card_number" type="number" pattern="{12}">
                            </label>

                            <label for="">
                                Expiry date
                                <br>
                                <input id="card_expiry_date" type="date">
                            </label>

                            <label for="">
                                CVC/CVV
                                <br>
                                <input id="card_cvv" type="number" pattern="{3}">
                            </label>

                        </div>

                    </div>

                </div>

            </div>

            <div id="right_div">

                <h2>Order summary</h2>

                <div id="order_summary">

                    <!-- <div class="order_items">

                        <img class="product_img" src="../../assets/image/stores/ivenus-apple/mobile (6).png" alt="product">
                        <div>
                            <h4 id="order_title">bdjkbsanemathandkujamrdjsbafabsano</h4>
                            <p>Store name: Iphones</p>
                            <p>$121212</p>
                        </div>

                    </div>

                    <div class="order_items">

                        <img class="product_img" src="../../assets/image/stores/Charles-Keith/bag3.jpeg" alt="product">
                        <div>
                            <h4 id="order_title">uyfhdjsbafabsano</h4>
                            <p>Store name: Iphones</p>
                            <p>$121212</p>
                        </div>

                    </div> -->

                </div>

                <span>Discount code</span>
                <label id="discount" for="">
                    <input type="text" name="" id="discount_code">
                    <button id="apply_btn">Apply</button>
                </label>

                <div>

                    <div id="total_box">
                        <div>
                            <h3>Subtotal</h3>
                            <h3>Delivery cast</h3>
                            <hr>
                            <h3>total</h3>
                        </div>

                        <div>
                            <h3 id="subtotal"></h3>
                            <h3>Free</h3>
                            <hr>
                            <h3 id="total"></h3>
                        </div>

                    </div>

                </div>

                <div id="btn_id">

                    <button type="submit" id="checkout_btn">Checkout</button>

                </div>

            </div>

        </header>

    </form>

    <script>        // get date code

        // let newdate;
        
        const dateObj = new Date();
        const month = dateObj.getUTCMonth() + 1; //months from 1-12
        const day = dateObj.getUTCDate()+2;
        const year = dateObj.getUTCFullYear();

        const newdate = `${day  }/${  month  }/${  year}`;
        console.log(newdate)

        // orders id code
        const order_id = Date.now();
        console.log(order_id)

        // Total Order Price
        // let total_price = 0

        const active_user = JSON.parse(localStorage.getItem('active_user'));

        document.getElementById("first_name").value = active_user.first_name;
        document.getElementById("last_name").value = active_user.last_name;
        document.getElementById("email").value = active_user.user_email;
        document.getElementById("phone_number").value = active_user.mobile_number;

        document.getElementById("address").value = active_user.address;
        document.getElementById("zip_code").value = active_user.zip_code;
        document.getElementById("state").value = active_user.state;
        document.getElementById("country").value = active_user.country;

        const Cart = JSON.parse(localStorage.getItem("Cart")) ?? []
        const storess = JSON.parse(localStorage.getItem("stores"))

        const url = window.location.search;                // ?name=Arun
        const urlParams = new URLSearchParams(url);        // converting string into key value pair
        const paramsId = urlParams.get("id")             // return value of the "name" key
        console.log(paramsId);

        // const num = Number(paramsId)

        let storeName;

        let itemObj = {};

        let totalPrice = 0;

        if (paramsId == Number(paramsId)) {

            console.log("work")

            storess.find(
                (product) => {

                    const items = product.products

                    // storeName = product["title"]

                    // console.log(items)

                    if (items) {
                        items.find(

                            (item) => {

                        // console.log(item)

                        if (item.value === paramsId) {
                            storeName = product.title
                            itemObj = item
                            return true;
                        }
                        
                            // alert("isnt match")
                            return false;

                    }
                        )
                    }
                    // return product;
                }
            )
            console.log(itemObj)

            totalPrice += Number(itemObj.price)

            // let div_order_items;
            // let img_product_img;
            // let div;
            // let h4_order_title;
            // let p_store_name;
            // let p_price;

            // <div class="order_items"></div>
            const div_order_items = document.createElement("div")
            div_order_items.setAttribute("class", "order_items")

            // <img class="product_img" src="../../assets/image/stores/ivenus-apple/mobile (6).png" alt="product">
            const img_product_img = document.createElement("img")
            img_product_img.setAttribute("class", "product_img")
            img_product_img.setAttribute("src", itemObj.image)
            img_product_img.setAttribute("alt", "product_img")
            div_order_items.prepend(img_product_img)

            // <div></div>
            const div = document.createElement("div")
            div_order_items.append(div)

            // <h4 id="order_title"></h4>
            const h4_order_title = document.createElement("h4")
            h4_order_title.setAttribute("id", "order_title")
            h4_order_title.innerText = itemObj.title;
            div.prepend(h4_order_title)

            // <p>Store name: Iphones</p>
            const p_store_name = document.createElement("p")
            p_store_name.innerText = `Storename: ${  storeName}`;
            div.append(p_store_name);

            // <p>$121212</p>
            const p_price = document.createElement("p")
            p_price.innerText = `₹${  itemObj.price}`;
            div.append(p_price)

            document.querySelector("#order_summary").append(div_order_items)

        }
        else {
            // console.log("dont")

            Cart.find(el => {

                if (paramsId === el.user_email) {

                    storess.find(e => {

                        if (e.value === el.store_value) {

                            storeName = e.title

                        }
                        // return e;
                    })

                    totalPrice += Number(el.price) * el.quantity

                    // let div_order_items;
                    // let img_product_img;
                    // let div;
                    // let h4_order_title;
                    // let p_store_name;
                    // let p_price;

                    // <div class="order_items"></div>
                    const div_order_items = document.createElement("div")
                    div_order_items.setAttribute("class", "order_items")

                    // <img class="product_img" src="../../assets/image/stores/ivenus-apple/mobile (6).png" alt="product">
                    const img_product_img = document.createElement("img")
                    img_product_img.setAttribute("class", "product_img")
                    img_product_img.setAttribute("src", el.image)
                    img_product_img.setAttribute("alt", "product_img")
                    div_order_items.prepend(img_product_img)

                    // <div></div>
                    const div = document.createElement("div")
                    div_order_items.append(div)

                    // <h4 id="order_title"></h4>
                    const h4_order_title = document.createElement("h4")
                    h4_order_title.setAttribute("id", "order_title")
                    h4_order_title.innerText = el.title;
                    div.prepend(h4_order_title)

                    // <p>Store name: Iphones</p>
                    const p_store_name = document.createElement("p")
                    p_store_name.innerText = `Storename:${  storeName}`;
                    div.append(p_store_name);

                    // <p>$121212</p>
                    const p_price = document.createElement("p")
                    p_price.innerText = `₹${  el.price  } ` + `x` + ` ${  el.quantity}`
                    div.append(p_price)

                    document.querySelector("#order_summary").append(div_order_items)

                }
                // return el;
            })

        }

        document.getElementById("subtotal").innerText = `₹${  totalPrice}`
        document.getElementById("total").innerText = `₹${  totalPrice}`

        // get checkout btn
        const form = document.getElementById("form")
        form.onsubmit = function checkout(e) {

            e.preventDefault()

            // payment option checked value
            const payment_option = document.querySelector(".radio:checked").value
            console.log(payment_option)

            const user_details = JSON.parse(localStorage.getItem("arr"))
            // const active_user = JSON.parse(localStorage.getItem("active_user"))

            user_details.find(el => {

                if (active_user.user_email === el.user_email) {

                    active_user.zip_code = document.getElementById("zip_code").value;
                    active_user.country = document.getElementById("country").value;
                    active_user.state = document.getElementById("state").value;
                    active_user.address = document.getElementById("address").value;
                    
                    localStorage.setItem("active_user", JSON.stringify(active_user))

                    el.zip_code = document.getElementById("zip_code").value;
                    el.country = document.getElementById("country").value;
                    el.state = document.getElementById("state").value;
                    el.address = document.getElementById("address").value;

                    localStorage.setItem("arr", JSON.stringify(user_details))

                }
                // return el;
            })

            const orders = JSON.parse(localStorage.getItem("orders")) ?? []

            // if(order_id == )

            if (paramsId == Number(paramsId)) {

                // let orders = JSON.parse(localStorage.getItem("orders")) ?? []

                const obj = {};

                obj.product_id = itemObj.value
                obj.user_email = active_user.user_email
                obj.order_id = order_id
                obj.ordered_by = storeName;
                obj.payment_option = payment_option;
                obj.order_date = newdate;
                obj.image = itemObj.image
                obj.title = itemObj.title
                obj.quantity = 1;
                obj.price = itemObj.price
                
                // user address
                obj.address = active_user.address
                obj.country = active_user.country
                obj.state = active_user.state
                obj.zip_code = active_user.zip_code
                obj.mobile_number = active_user.mobile_number

                orders.push(obj)
                localStorage.setItem("orders", JSON.stringify(orders))

            }
            else {

                // let orders = JSON.parse(localStorage.getItem("orders")) ?? []

                Cart.find(el => {

                    if (paramsId === el.user_email) {

                        const obj = {};

                        obj.product_id = el.value
                        obj.user_email = el.user_email
                        obj.order_id = order_id
                        obj.ordered_by = "Cart"
                        obj.payment_option = payment_option;
                        obj.order_date = newdate;
                        obj.image = el.image
                        obj.title = el.title
                        obj.quantity = el.quantity
                        obj.price = el.price

                        // user address
                        obj.address = active_user.address
                        obj.country = active_user.country
                        obj.state = active_user.state
                        obj.zip_code = active_user.zip_code
                        obj.mobile_number = active_user.mobile_number

                        orders.push(obj)
                        localStorage.setItem("orders", JSON.stringify(orders))

                    }
                    // return el;
                })

            }

            window.location.href = `confirm_order.html?order_id=${  order_id}`;

        }

        // Cart count codes

        const Cart1 = JSON.parse(localStorage.getItem("Cart")) ?? []
        const active_user1 = JSON.parse(localStorage.getItem("active_user"))
        const cart_count = document.getElementById("cart_count")
        let count = 0;

        Cart1.find(e => {
            if (e.user_email === active_user1.user_email) {
                count++
            }
            // return e;
        })
        console.log(count)

        cart_count.innerText = count
    </script>

</body>

</html>